import os
import asyncio
from telegram import Update, ReplyKeyboardMarkup
from telegram.ext import Application, CommandHandler, MessageHandler, filters, ContextTypes
from keep_alive import keep_alive  # â† Ğ”ĞĞ‘ĞĞ’Ğ¬ Ğ­Ğ¢Ğ£ Ğ¡Ğ¢Ğ ĞĞšĞ£

# Ğ—Ğ°Ğ¿ÑƒÑĞºĞ°ĞµĞ¼ keep-alive ÑĞµÑ€Ğ²ĞµÑ€
keep_alive()  # â† Ğ”ĞĞ‘ĞĞ’Ğ¬ Ğ­Ğ¢Ğ£ Ğ¡Ğ¢Ğ ĞĞšĞ£
print("ğŸ”„ Keep-alive server started!")

# Ğ¢Ğ¾ĞºĞµĞ½ Ğ¸Ğ· Ğ¿ĞµÑ€ĞµĞ¼ĞµĞ½Ğ½Ñ‹Ñ… Ğ¾ĞºÑ€ÑƒĞ¶ĞµĞ½Ğ¸Ñ Render
BOT_TOKEN = os.environ.get('BOT_TOKEN')

if not BOT_TOKEN:
    print("âŒ ERROR: BOT_TOKEN not found!")
    exit(1)

print("âœ… Bot starting with keep-alive...")

# ĞšĞ ĞĞ¡Ğ˜Ğ’Ğ«Ğ• Ğ¨Ğ Ğ˜Ğ¤Ğ¢Ğ«
FONTS = {
    "ğŸ”¤ ĞĞ±Ñ‹Ñ‡Ğ½Ñ‹Ğ¹": "normal",
    "ğŸ…±ï¸ Ğ–Ğ¸Ñ€Ğ½Ñ‹Ğ¹": "bold", 
    "â„¹ï¸ ĞšÑƒÑ€ÑĞ¸Ğ²": "italic",
    "ğŸ”  ĞœĞ¾Ğ½Ğ¾ÑˆĞ¸Ñ€Ğ¸Ğ½Ğ½Ñ‹Ğ¹": "monospace",
    "ğŸª„ ĞœĞ°Ğ³Ğ¸Ñ‡ĞµÑĞºĞ¸Ğ¹": "spoiler",
    "âœ¨ ĞšÑ€ÑƒĞ¶Ğ¾Ñ‡ĞºĞ¸": "circles",
    "â“‚ï¸ Ğ—Ğ°Ñ‡ĞµÑ€ĞºĞ½ÑƒÑ‚Ñ‹Ğ¹": "strikethrough",
    "ğŸ”¡ ĞœĞ°Ğ»ĞµĞ½ÑŒĞºĞ¸Ğµ": "small_caps",
    "ğŸŒ€ Ğ’Ğ¾Ğ»Ğ½Ğ¸ÑÑ‚Ñ‹Ğ¹": "wavy",
    "ğŸ’« Ğ”Ğ²Ğ¾Ğ¹Ğ½Ğ¾Ğ¹": "double_struck",
    "ğŸ…°ï¸ ĞšÑƒÑ€ÑĞ¸Ğ²Ğ½Ñ‹Ğ¹2": "script",
    "ğŸ”· ĞšĞ²Ğ°Ğ´Ñ€Ğ°Ñ‚Ñ‹": "squares",
    "ğŸ”¥ ĞĞ³Ğ½ĞµĞ½Ğ½Ñ‹Ğ¹": "fire",
    "â„ï¸ Ğ¡Ğ½ĞµĞ¶Ğ½Ñ‹Ğ¹": "snow",
    "âš¡ ĞœĞ¾Ğ»Ğ½Ğ¸Ñ": "lightning"
}

# Ğ¡ĞŸĞ•Ğ¦Ğ˜ĞĞ›Ğ¬ĞĞ«Ğ• Ğ¡Ğ˜ĞœĞ’ĞĞ›Ğ« Ğ”Ğ›Ğ¯ ĞšĞ ĞĞ¡Ğ˜Ğ’Ğ«Ğ¥ Ğ¨Ğ Ğ˜Ğ¤Ğ¢ĞĞ’
FONT_MAP = {
    "circles": {
        'a': 'â“', 'b': 'â“‘', 'c': 'â“’', 'd': 'â““', 'e': 'â“”', 'f': 'â“•', 'g': 'â“–', 'h': 'â“—',
        'i': 'â“˜', 'j': 'â“™', 'k': 'â“š', 'l': 'â“›', 'm': 'â“œ', 'n': 'â“', 'o': 'â“', 'p': 'â“Ÿ',
        'q': 'â“ ', 'r': 'â“¡', 's': 'â“¢', 't': 'â“£', 'u': 'â“¤', 'v': 'â“¥', 'w': 'â“¦', 'x': 'â“§',
        'y': 'â“¨', 'z': 'â“©', 'A': 'â’¶', 'B': 'â’·', 'C': 'â’¸', 'D': 'â’¹', 'E': 'â’º', 'F': 'â’»',
        'G': 'â’¼', 'H': 'â’½', 'I': 'â’¾', 'J': 'â’¿', 'K': 'â“€', 'L': 'â“', 'M': 'â“‚', 'N': 'â“ƒ',
        'O': 'â“„', 'P': 'â“…', 'Q': 'â“†', 'R': 'â“‡', 'S': 'â“ˆ', 'T': 'â“‰', 'U': 'â“Š', 'V': 'â“‹',
        'W': 'â“Œ', 'X': 'â“', 'Y': 'â“', 'Z': 'â“', '0': 'â“ª', '1': 'â‘ ', '2': 'â‘¡', '3': 'â‘¢',
        '4': 'â‘£', '5': 'â‘¤', '6': 'â‘¥', '7': 'â‘¦', '8': 'â‘§', '9': 'â‘¨'
    },
    "small_caps": {
        'a': 'á´€', 'b': 'Ê™', 'c': 'á´„', 'd': 'á´…', 'e': 'á´‡', 'f': 'Ò“', 'g': 'É¢', 'h': 'Êœ',
        'i': 'Éª', 'j': 'á´Š', 'k': 'á´‹', 'l': 'ÊŸ', 'm': 'á´', 'n': 'É´', 'o': 'á´', 'p': 'á´˜',
        'q': 'Ç«', 'r': 'Ê€', 's': 's', 't': 'á´›', 'u': 'á´œ', 'v': 'á´ ', 'w': 'á´¡', 'x': 'x',
        'y': 'Ê', 'z': 'á´¢'
    },
    "double_struck": {
        'a': 'ğ•’', 'b': 'ğ•“', 'c': 'ğ•”', 'd': 'ğ••', 'e': 'ğ•–', 'f': 'ğ•—', 'g': 'ğ•˜', 'h': 'ğ•™',
        'i': 'ğ•š', 'j': 'ğ•›', 'k': 'ğ•œ', 'l': 'ğ•', 'm': 'ğ•', 'n': 'ğ•Ÿ', 'o': 'ğ• ', 'p': 'ğ•¡',
        'q': 'ğ•¢', 'r': 'ğ•£', 's': 'ğ•¤', 't': 'ğ•¥', 'u': 'ğ•¦', 'v': 'ğ•§', 'w': 'ğ•¨', 'x': 'ğ•©',
        'y': 'ğ•ª', 'z': 'ğ•«', 'A': 'ğ”¸', 'B': 'ğ”¹', 'C': 'â„‚', 'D': 'ğ”»', 'E': 'ğ”¼', 'F': 'ğ”½',
        'G': 'ğ”¾', 'H': 'â„', 'I': 'ğ•€', 'J': 'ğ•', 'K': 'ğ•‚', 'L': 'ğ•ƒ', 'M': 'ğ•„', 'N': 'â„•',
        'O': 'ğ•†', 'P': 'â„™', 'Q': 'â„š', 'R': 'â„', 'S': 'ğ•Š', 'T': 'ğ•‹', 'U': 'ğ•Œ', 'V': 'ğ•',
        'W': 'ğ•', 'X': 'ğ•', 'Y': 'ğ•', 'Z': 'â„¤'
    },
    "script": {
        'a': 'ğ’¶', 'b': 'ğ’·', 'c': 'ğ’¸', 'd': 'ğ’¹', 'e': 'ğ‘’', 'f': 'ğ’»', 'g': 'ğ‘”', 'h': 'ğ’½',
        'i': 'ğ’¾', 'j': 'ğ’¿', 'k': 'ğ“€', 'l': 'ğ“', 'm': 'ğ“‚', 'n': 'ğ“ƒ', 'o': 'ğ‘œ', 'p': 'ğ“…',
        'q': 'ğ“†', 'r': 'ğ“‡', 's': 'ğ“ˆ', 't': 'ğ“‰', 'u': 'ğ“Š', 'v': 'ğ“‹', 'w': 'ğ“Œ', 'x': 'ğ“',
        'y': 'ğ“', 'z': 'ğ“', 'A': 'ğ’œ', 'B': 'ğµ', 'C': 'ğ’', 'D': 'ğ’Ÿ', 'E': 'ğ¸', 'F': 'ğ¹',
        'G': 'ğ’¢', 'H': 'ğ»', 'I': 'ğ¼', 'J': 'ğ’¥', 'K': 'ğ’¦', 'L': 'ğ¿', 'M': 'ğ‘€', 'N': 'ğ’©',
        'O': 'ğ’ª', 'P': 'ğ’«', 'Q': 'ğ’¬', 'R': 'ğ‘…', 'S': 'ğ’®', 'T': 'ğ’¯', 'U': 'ğ’°', 'V': 'ğ’±',
        'W': 'ğ’²', 'X': 'ğ’³', 'Y': 'ğ’´', 'Z': 'ğ’µ'
    },
    "squares": {
        'a': 'ğŸ„°', 'b': 'ğŸ„±', 'c': 'ğŸ„²', 'd': 'ğŸ„³', 'e': 'ğŸ„´', 'f': 'ğŸ„µ', 'g': 'ğŸ„¶', 'h': 'ğŸ„·',
        'i': 'ğŸ„¸', 'j': 'ğŸ„¹', 'k': 'ğŸ„º', 'l': 'ğŸ„»', 'm': 'ğŸ„¼', 'n': 'ğŸ„½', 'o': 'ğŸ„¾', 'p': 'ğŸ„¿',
        'q': 'ğŸ…€', 'r': 'ğŸ…', 's': 'ğŸ…‚', 't': 'ğŸ…ƒ', 'u': 'ğŸ…„', 'v': 'ğŸ……', 'w': 'ğŸ…†', 'x': 'ğŸ…‡',
        'y': 'ğŸ…ˆ', 'z': 'ğŸ…‰', 'A': 'ğŸ„°', 'B': 'ğŸ„±', 'C': 'ğŸ„²', 'D': 'ğŸ„³', 'E': 'ğŸ„´', 'F': 'ğŸ„µ',
        'G': 'ğŸ„¶', 'H': 'ğŸ„·', 'I': 'ğŸ„¸', 'J': 'ğŸ„¹', 'K': 'ğŸ„º', 'L': 'ğŸ„»', 'M': 'ğŸ„¼', 'N': 'ğŸ„½',
        'O': 'ğŸ„¾', 'P': 'ğŸ„¿', 'Q': 'ğŸ…€', 'R': 'ğŸ…', 'S': 'ğŸ…‚', 'T': 'ğŸ…ƒ', 'U': 'ğŸ…„', 'V': 'ğŸ……',
        'W': 'ğŸ…†', 'X': 'ğŸ…‡', 'Y': 'ğŸ…ˆ', 'Z': 'ğŸ…‰'
    },
    "wavy": {
        'a': 'ğ“ª', 'b': 'ğ“«', 'c': 'ğ“¬', 'd': 'ğ“­', 'e': 'ğ“®', 'f': 'ğ“¯', 'g': 'ğ“°', 'h': 'ğ“±',
        'i': 'ğ“²', 'j': 'ğ“³', 'k': 'ğ“´', 'l': 'ğ“µ', 'm': 'ğ“¶', 'n': 'ğ“·', 'o': 'ğ“¸', 'p': 'ğ“¹',
        'q': 'ğ“º', 'r': 'ğ“»', 's': 'ğ“¼', 't': 'ğ“½', 'u': 'ğ“¾', 'v': 'ğ“¿', 'w': 'ğ”€', 'x': 'ğ”',
        'y': 'ğ”‚', 'z': 'ğ”ƒ', 'A': 'ğ“', 'B': 'ğ“‘', 'C': 'ğ“’', 'D': 'ğ““', 'E': 'ğ“”', 'F': 'ğ“•',
        'G': 'ğ“–', 'H': 'ğ“—', 'I': 'ğ“˜', 'J': 'ğ“™', 'K': 'ğ“š', 'L': 'ğ“›', 'M': 'ğ“œ', 'N': 'ğ“',
        'O': 'ğ“', 'P': 'ğ“Ÿ', 'Q': 'ğ“ ', 'R': 'ğ“¡', 'S': 'ğ“¢', 'T': 'ğ“£', 'U': 'ğ“¤', 'V': 'ğ“¥',
        'W': 'ğ“¦', 'X': 'ğ“§', 'Y': 'ğ“¨', 'Z': 'ğ“©'
    },
    "fire": {
        'a': 'aÒ‰', 'b': 'bÒ‰', 'c': 'cÒ‰', 'd': 'dÒ‰', 'e': 'eÒ‰', 'f': 'fÒ‰', 'g': 'gÒ‰', 'h': 'hÒ‰',
        'i': 'iÒ‰', 'j': 'jÒ‰', 'k': 'kÒ‰', 'l': 'lÒ‰', 'm': 'mÒ‰', 'n': 'nÒ‰', 'o': 'oÒ‰', 'p': 'pÒ‰',
        'q': 'qÒ‰', 'r': 'rÒ‰', 's': 'sÒ‰', 't': 'tÒ‰', 'u': 'uÒ‰', 'v': 'vÒ‰', 'w': 'wÒ‰', 'x': 'xÒ‰',
        'y': 'yÒ‰', 'z': 'zÒ‰', 'A': 'AÒ‰', 'B': 'BÒ‰', 'C': 'CÒ‰', 'D': 'DÒ‰', 'E': 'EÒ‰', 'F': 'FÒ‰',
        'G': 'GÒ‰', 'H': 'HÒ‰', 'I': 'IÒ‰', 'J': 'JÒ‰', 'K': 'KÒ‰', 'L': 'LÒ‰', 'M': 'MÒ‰', 'N': 'NÒ‰',
        'O': 'OÒ‰', 'P': 'PÒ‰', 'Q': 'QÒ‰', 'R': 'RÒ‰', 'S': 'SÒ‰', 'T': 'TÒ‰', 'U': 'UÒ‰', 'V': 'VÒ‰',
        'W': 'WÒ‰', 'X': 'XÒ‰', 'Y': 'YÒ‰', 'Z': 'ZÒ‰'
    },
    "snow": {
        'a': 'aâ„ï¸', 'b': 'bâ„ï¸', 'c': 'câ„ï¸', 'd': 'dâ„ï¸', 'e': 'eâ„ï¸', 'f': 'fâ„ï¸', 'g': 'gâ„ï¸', 'h': 'hâ„ï¸',
        'i': 'iâ„ï¸', 'j': 'jâ„ï¸', 'k': 'kâ„ï¸', 'l': 'lâ„ï¸', 'm': 'mâ„ï¸', 'n': 'nâ„ï¸', 'o': 'oâ„ï¸', 'p': 'pâ„ï¸',
        'q': 'qâ„ï¸', 'r': 'râ„ï¸', 's': 'sâ„ï¸', 't': 'tâ„ï¸', 'u': 'uâ„ï¸', 'v': 'vâ„ï¸', 'w': 'wâ„ï¸', 'x': 'xâ„ï¸',
        'y': 'yâ„ï¸', 'z': 'zâ„ï¸', 'A': 'Aâ„ï¸', 'B': 'Bâ„ï¸', 'C': 'Câ„ï¸', 'D': 'Dâ„ï¸', 'E': 'Eâ„ï¸', 'F': 'Fâ„ï¸',
        'G': 'Gâ„ï¸', 'H': 'Hâ„ï¸', 'I': 'Iâ„ï¸', 'J': 'Jâ„ï¸', 'K': 'Kâ„ï¸', 'L': 'Lâ„ï¸', 'M': 'Mâ„ï¸', 'N': 'Nâ„ï¸',
        'O': 'Oâ„ï¸', 'P': 'Pâ„ï¸', 'Q': 'Qâ„ï¸', 'R': 'Râ„ï¸', 'S': 'Sâ„ï¸', 'T': 'Tâ„ï¸', 'U': 'Uâ„ï¸', 'V': 'Vâ„ï¸',
        'W': 'Wâ„ï¸', 'X': 'Xâ„ï¸', 'Y': 'Yâ„ï¸', 'Z': 'Zâ„ï¸'
    },
    "lightning": {
        'a': 'aâš¡', 'b': 'bâš¡', 'c': 'câš¡', 'd': 'dâš¡', 'e': 'eâš¡', 'f': 'fâš¡', 'g': 'gâš¡', 'h': 'hâš¡',
        'i': 'iâš¡', 'j': 'jâš¡', 'k': 'kâš¡', 'l': 'lâš¡', 'm': 'mâš¡', 'n': 'nâš¡', 'o': 'oâš¡', 'p': 'pâš¡',
        'q': 'qâš¡', 'r': 'râš¡', 's': 'sâš¡', 't': 'tâš¡', 'u': 'uâš¡', 'v': 'vâš¡', 'w': 'wâš¡', 'x': 'xâš¡',
        'y': 'yâš¡', 'z': 'zâš¡', 'A': 'Aâš¡', 'B': 'Bâš¡', 'C': 'Câš¡', 'D': 'Dâš¡', 'E': 'Eâš¡', 'F': 'Fâš¡',
        'G': 'Gâš¡', 'H': 'Hâš¡', 'I': 'Iâš¡', 'J': 'Jâš¡', 'K': 'Kâš¡', 'L': 'Lâš¡', 'M': 'Mâš¡', 'N': 'Nâš¡',
        'O': 'Oâš¡', 'P': 'Pâš¡', 'Q': 'Qâš¡', 'R': 'Râš¡', 'S': 'Sâš¡', 'T': 'Tâš¡', 'U': 'Uâš¡', 'V': 'Vâš¡',
        'W': 'Wâš¡', 'X': 'Xâš¡', 'Y': 'Yâš¡', 'Z': 'Zâš¡'
    }
}

def apply_font(text, font_type):
    """ĞŸÑ€Ğ¸Ğ¼ĞµĞ½ÑĞµÑ‚ ĞºÑ€Ğ°ÑĞ¸Ğ²Ñ‹Ğ¹ ÑˆÑ€Ğ¸Ñ„Ñ‚ Ğº Ñ‚ĞµĞºÑÑ‚Ñƒ"""
    if font_type == "normal":
        return text
    elif font_type == "bold":
        return f"**{text}**"
    elif font_type == "italic":
        return f"_{text}_"
    elif font_type == "monospace":
        return f"`{text}`"
    elif font_type == "spoiler":
        return f"||{text}||"
    elif font_type == "strikethrough":
        return f"~{text}~"
    elif font_type in FONT_MAP:
        # ĞŸÑ€Ğ¸Ğ¼ĞµĞ½ÑĞµĞ¼ ĞºĞ°ÑÑ‚Ğ¾Ğ¼Ğ½Ñ‹Ğ¹ ÑˆÑ€Ğ¸Ñ„Ñ‚
        result = ""
        font_chars = FONT_MAP[font_type]
        for char in text:
            result += font_chars.get(char, char)
        return result
    return text

async def start(update: Update, context: ContextTypes.DEFAULT_TYPE):
    """ĞšĞ¾Ğ¼Ğ°Ğ½Ğ´Ğ° /start Ñ ĞºÑ€Ğ°ÑĞ¸Ğ²Ñ‹Ğ¼ Ğ¼ĞµĞ½Ñ"""
    # Ğ¡Ğ¾Ğ·Ğ´Ğ°ĞµĞ¼ ĞºĞ»Ğ°Ğ²Ğ¸Ğ°Ñ‚ÑƒÑ€Ñƒ Ğ² 2 ĞºĞ¾Ğ»Ğ¾Ğ½ĞºĞ¸ Ğ´Ğ»Ñ ĞºÑ€Ğ°ÑĞ¾Ñ‚Ñ‹
    fonts_list = list(FONTS.keys())
    keyboard = []
    
    # Ğ Ğ°Ğ·Ğ±Ğ¸Ğ²Ğ°ĞµĞ¼ Ğ½Ğ° Ñ€ÑĞ´Ñ‹ Ğ¿Ğ¾ 2 ĞºĞ½Ğ¾Ğ¿ĞºĞ¸
    for i in range(0, len(fonts_list), 2):
        row = fonts_list[i:i+2]
        keyboard.append(row)
    
    reply_markup = ReplyKeyboardMarkup(keyboard, resize_keyboard=True)
    
    welcome_text = """
ğŸ¨ *Ğ‘Ğ¾Ñ‚ Ğ´Ğ»Ñ ĞšĞ ĞĞ¡Ğ˜Ğ’Ğ«Ğ¥ ÑˆÑ€Ğ¸Ñ„Ñ‚Ğ¾Ğ²!* âœ¨

ğŸ¤– *ĞšĞ°Ğº Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ÑŒ:*
1ï¸âƒ£ Ğ’Ñ‹Ğ±ĞµÑ€Ğ¸ ÑˆÑ€Ğ¸Ñ„Ñ‚ Ğ¸Ğ· Ğ¼ĞµĞ½Ñ Ğ½Ğ¸Ğ¶Ğµ
2ï¸âƒ£ ĞÑ‚Ğ¿Ñ€Ğ°Ğ²ÑŒ Ñ‚ĞµĞºÑÑ‚ Ğ´Ğ»Ñ Ğ¿Ñ€ĞµĞ¾Ğ±Ñ€Ğ°Ğ·Ğ¾Ğ²Ğ°Ğ½Ğ¸Ñ  
3ï¸âƒ£ ĞŸĞ¾Ğ»ÑƒÑ‡Ğ¸ ÑÑ‚Ğ¸Ğ»ÑŒĞ½Ñ‹Ğ¹ Ñ€ĞµĞ·ÑƒĞ»ÑŒÑ‚Ğ°Ñ‚!

*Ğ’Ñ‹Ğ±Ğ¸Ñ€Ğ°Ğ¹ Ğ¸ Ñ‚Ğ²Ğ¾Ñ€Ğ¸!* ğŸ­
"""
    
    await update.message.reply_text(
        welcome_text,
        reply_markup=reply_markup,
        parse_mode='Markdown'
    )

async def handle_text(update: Update, context: ContextTypes.DEFAULT_TYPE):
    """ĞĞ±Ñ€Ğ°Ğ±Ğ¾Ñ‚ĞºĞ° Ñ‚ĞµĞºÑÑ‚Ğ°"""
    user_text = update.message.text
    
    # Ğ•ÑĞ»Ğ¸ Ğ²Ñ‹Ğ±Ñ€Ğ°Ğ»Ğ¸ ÑˆÑ€Ğ¸Ñ„Ñ‚ Ğ¸Ğ· Ğ¼ĞµĞ½Ñ
    if user_text in FONTS:
        selected_font = FONTS[user_text]
        context.user_data['selected_font'] = selected_font
        
        await update.message.reply_text(
            f"âœ… Ğ’Ñ‹Ğ±Ñ€Ğ°Ğ½ ÑˆÑ€Ğ¸Ñ„Ñ‚: *{user_text}*\n\n"
            f"ğŸ“ Ğ¢ĞµĞ¿ĞµÑ€ÑŒ Ğ¾Ñ‚Ğ¿Ñ€Ğ°Ğ²ÑŒ Ñ‚ĞµĞºÑÑ‚ Ğ´Ğ»Ñ Ğ¿Ñ€ĞµĞ¾Ğ±Ñ€Ğ°Ğ·Ğ¾Ğ²Ğ°Ğ½Ğ¸Ñ!",
            parse_mode='Markdown'
        )
        return
    
    # Ğ•ÑĞ»Ğ¸ ÑÑ‚Ğ¾ Ñ‚ĞµĞºÑÑ‚ Ğ´Ğ»Ñ Ğ¿Ñ€ĞµĞ¾Ğ±Ñ€Ğ°Ğ·Ğ¾Ğ²Ğ°Ğ½Ğ¸Ñ
    selected_font = context.user_data.get('selected_font')
    
    if not selected_font:
        fonts_list = list(FONTS.keys())
        keyboard = []
        for i in range(0, len(fonts_list), 2):
            row = fonts_list[i:i+2]
            keyboard.append(row)
        reply_markup = ReplyKeyboardMarkup(keyboard, resize_keyboard=True)
        
        await update.message.reply_text(
            "âš ï¸ *Ğ¡Ğ½Ğ°Ñ‡Ğ°Ğ»Ğ° Ğ²Ñ‹Ğ±ĞµÑ€Ğ¸ ÑˆÑ€Ğ¸Ñ„Ñ‚ Ğ¸Ğ· Ğ¼ĞµĞ½Ñ Ğ½Ğ¸Ğ¶Ğµ!*",
            reply_markup=reply_markup,
            parse_mode='Markdown'
        )
        return
    
    if not user_text.strip():
        await update.message.reply_text("ğŸ“ ĞŸĞ¾Ğ¶Ğ°Ğ»ÑƒĞ¹ÑÑ‚Ğ°, Ğ²Ğ²ĞµĞ´Ğ¸Ñ‚Ğµ Ñ‚ĞµĞºÑÑ‚ Ğ´Ğ»Ñ Ğ¿Ñ€ĞµĞ¾Ğ±Ñ€Ğ°Ğ·Ğ¾Ğ²Ğ°Ğ½Ğ¸Ñ!")
        return
    
    try:
        formatted_text = apply_font(user_text, selected_font)
        
        # ĞĞ¿Ñ€ĞµĞ´ĞµĞ»ÑĞµĞ¼ Ñ€ĞµĞ¶Ğ¸Ğ¼ Ğ¿Ğ°Ñ€ÑĞ¸Ğ½Ğ³Ğ°
        parse_mode = None
        if selected_font in ["bold", "italic", "monospace", "spoiler", "strikethrough"]:
            parse_mode = 'MarkdownV2'
        
        await update.message.reply_text(
            f"ğŸ¨ *Ğ ĞµĞ·ÑƒĞ»ÑŒÑ‚Ğ°Ñ‚:*\n\n{formatted_text}",
            parse_mode=parse_mode
        )
            
    except Exception as e:
        await update.message.reply_text(
            "âŒ ĞŸÑ€Ğ¾Ğ¸Ğ·Ğ¾ÑˆĞ»Ğ° Ğ¾ÑˆĞ¸Ğ±ĞºĞ° Ğ¿Ñ€Ğ¸ Ğ¿Ñ€ĞµĞ¾Ğ±Ñ€Ğ°Ğ·Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğ¸ Ñ‚ĞµĞºÑÑ‚Ğ°. ĞŸĞ¾Ğ¿Ñ€Ğ¾Ğ±ÑƒĞ¹ Ğ´Ñ€ÑƒĞ³Ğ¾Ğ¹ Ñ‚ĞµĞºÑÑ‚ Ğ¸Ğ»Ğ¸ ÑˆÑ€Ğ¸Ñ„Ñ‚."
        )

async def help_command(update: Update, context: ContextTypes.DEFAULT_TYPE):
    """ĞšĞ¾Ğ¼Ğ°Ğ½Ğ´Ğ° /help"""
    help_text = """
ğŸ†˜ *ĞŸĞ¾Ğ¼Ğ¾Ñ‰ÑŒ Ğ¿Ğ¾ Ğ±Ğ¾Ñ‚Ñƒ*

*ğŸ¤– ĞšĞ¾Ğ¼Ğ°Ğ½Ğ´Ñ‹:*
/start - Ğ½Ğ°Ñ‡Ğ°Ñ‚ÑŒ Ñ€Ğ°Ğ±Ğ¾Ñ‚Ñƒ Ñ Ğ±Ğ¾Ñ‚Ğ¾Ğ¼  
/help - Ğ¿Ğ¾ĞºĞ°Ğ·Ğ°Ñ‚ÑŒ ÑÑ‚Ñƒ ÑĞ¿Ñ€Ğ°Ğ²ĞºÑƒ

*ğŸ“± ĞšĞ°Ğº Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ÑŒ:*
1. Ğ’Ñ‹Ğ±ĞµÑ€Ğ¸ ÑˆÑ€Ğ¸Ñ„Ñ‚ Ğ¸Ğ· Ğ¼ĞµĞ½Ñ
2. ĞÑ‚Ğ¿Ñ€Ğ°Ğ²ÑŒ Ğ»ÑĞ±Ğ¾Ğ¹ Ñ‚ĞµĞºÑÑ‚
3. ĞŸĞ¾Ğ»ÑƒÑ‡Ğ¸ ĞºÑ€Ğ°ÑĞ¸Ğ²Ñ‹Ğ¹ Ñ€ĞµĞ·ÑƒĞ»ÑŒÑ‚Ğ°Ñ‚!

*ĞĞ°ÑĞ»Ğ°Ğ¶Ğ´Ğ°Ğ¹ÑÑ ÑĞ¾Ğ·Ğ´Ğ°Ğ½Ğ¸ĞµĞ¼ ĞºÑ€Ğ°ÑĞ¸Ğ²Ñ‹Ñ… Ñ‚ĞµĞºÑÑ‚Ğ¾Ğ²!* âœ¨
"""
    await update.message.reply_text(help_text, parse_mode='Markdown')

def main():
    """ĞÑĞ½Ğ¾Ğ²Ğ½Ğ°Ñ Ñ„ÑƒĞ½ĞºÑ†Ğ¸Ñ"""
    application = Application.builder().token(BOT_TOKEN).build()
    
    # Ğ”Ğ¾Ğ±Ğ°Ğ²Ğ»ÑĞµĞ¼ Ğ¾Ğ±Ñ€Ğ°Ğ±Ğ¾Ñ‚Ñ‡Ğ¸ĞºĞ¸
    application.add_handler(CommandHandler("start", start))
    application.add_handler(CommandHandler("help", help_command))
    application.add_handler(MessageHandler(filters.TEXT & ~filters.COMMAND, handle_text))
    
    print("âœ… Ğ‘Ğ¾Ñ‚ Ñ ĞºÑ€Ğ°ÑĞ¸Ğ²Ñ‹Ğ¼Ğ¸ ÑˆÑ€Ğ¸Ñ„Ñ‚Ğ°Ğ¼Ğ¸ Ğ·Ğ°Ğ¿ÑƒÑ‰ĞµĞ½ Ğ½Ğ° Railway!")
    application.run_polling()

if __name__ == "__main__":

    main()

